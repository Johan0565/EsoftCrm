
# üß† –ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ª–∏–¥–∞

> **–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è:**  
> üìÑ `lead_form.py` ‚Üí –º–µ—Ç–æ–¥ `auto_assign(self)`  
> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–∞ –ª–∏–¥–∞ —Å —É—á—ë—Ç–æ–º:
> - üîÑ –ù–∞–≥—Ä—É–∑–∫–∏ (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤)
> - ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–∫–æ–ª-–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª–∏–¥–æ–≤)
> - üéØ –ö–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞–≤—ã–∫–æ–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)

---

## ‚öôÔ∏è –®–∞–≥–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

### 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ `p1`, `p2`, `p3`

```python
s = self.p1.value() + self.p2.value() + self.p3.value()
p1, p2, p3 = (1/3, 1/3, 1/3) if s <= 0 else (
    self.p1.value()/s, self.p2.value()/s, self.p3.value()/s
)
```

### 2. –°–±–æ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

```python
sql, params = eligible_users_sql()
cur.execute(sql, params)
users = cur.fetchall()
```

### 3. –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫:

```python
for u in users:
    cur.execute("SELECT COUNT(*) AS L FROM leads WHERE current_assignee_id=%s", (u['id'],))
    u['L'] = cur.fetchone()['L']
    cur.execute("SELECT COUNT(*) AS A FROM leads WHERE current_assignee_id=%s AND is_active=1", (u['id'],))
    u['A'] = cur.fetchone()['A']
```

### 4. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

```python
Lmax = max([u['L'] for u in users]) or 1
Amax = max([u['A'] for u in users]) or 1
```

### 5. –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ + –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ:

```python
for u in users:
    dot = (float(u['sp'])*R[0] + float(u['so'])*R[1] + float(u['ss'])*R[2]) / 3.0
    score = ((Lmax - u['L'])/Lmax) * p1 + ((Amax - u['A'])/Amax) * p2 + dot * p3
    if score > best_score:
        best_score, best_id = score, u['id']
```

---

## ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

- `eligible_users_sql()` ‚Äî —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `agent`, `manager`, `admin`
- `quality_component()` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–≤ `algorithms.py`)
- `test_algorithms.py` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º—É–ª—ã
- `run_examples.py` ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞—Å—á—ë—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö

## üßë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### `users`
–°–æ–¥–µ—Ä–∂–∏—Ç —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –ª–æ–≥–∏–Ω, –§–ò–û, email, –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–∞–≤—ã–∫–∏ (`skill_*`), —Ñ–ª–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è.  
üìå –°–≤—è–∑–∞–Ω–∞ —Å: `auth_credentials`, `user_roles`, `user_skills`, `calls`, `leads`

### `auth_credentials`
–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞: –∞–ª–≥–æ—Ä–∏—Ç–º —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è (`pbkdf2_sha256`), —Å–æ–ª—å, —Ö—ç—à, –∫–æ–ª-–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π.  
‚ö†Ô∏è –•—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.  
üìå –°–≤—è–∑–∞–Ω–∞ —Å `users` (–ø–æ `user_id`)

### `registration_tokens`
–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, email, –ø–∞—Ä–æ–ª—å, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è).  
üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### `email_verification_codes`
–ó–∞–ø–∞—Å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö—ç—à–µ–π email-–∫–æ–¥–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ –Ω–∞–ø—Ä—è–º—É—é).

---

## üìû –ö–ª–∏–µ–Ω—Ç—ã, –ª–∏–¥—ã –∏ –∑–≤–æ–Ω–∫–∏

### `leads`
–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–æ–≤ (–∑–∞—è–≤–æ–∫): —Ç–µ–ª–µ—Ñ–æ–Ω/email, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ç–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (`req_*`), –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.  
üìå –°–≤—è–∑–∞–Ω–∞ —Å: `users`, `calls`, `lead_assignments`, `lead_requirements`

### `lead_assignments`
–ò—Å—Ç–æ—Ä–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –ª–∏–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–æ–¥–∏–Ω –ª–∏–¥ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏).  
üìå –°–≤—è–∑–∞–Ω–∞ —Å `leads`, `users`

### `calls`
–ó–≤–æ–Ω–∫–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ª–∏–¥–∞–º–∏: –∫–æ–≥–¥–∞, –∫–µ–º, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, —Ñ–ª–∞–≥ —É–¥–∞–ª–µ–Ω–∏—è.  
üìå –°–≤—è–∑–∞–Ω–∞ —Å `leads`, `users`

---

## üìä –û—Ü–µ–Ω–∫–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

### `skills`
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –Ω–∞–≤—ã–∫–æ–≤: –Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–æ–¥–∞–∂–∏", "–†–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏", "–ó–Ω–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏".

### `user_skills`
–£—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–æ–≤ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –ø–æ —à–∫–∞–ª–µ –æ—Ç 0 –¥–æ 1 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `skill_id`.  
üìå –°–≤—è–∑–∞–Ω–∞ —Å `skills`, `users`

### `lead_requirements`
–¢—Ä–µ–±—É–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–æ–≤ –æ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞.  
üìå –°–≤—è–∑–∞–Ω–∞ —Å `skills`, `leads`

---

## üîê –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞

### `roles`
–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ä–æ–ª–µ–π: `admin`, `manager`, `agent`, `client`

### `user_roles`
–°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏ (–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º).  
üìå –°–≤—è–∑–∞–Ω–∞ —Å `roles`, `users`

---

## ‚öôÔ∏è –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

### `strategy_settings`
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ—Å–æ–≤ p1/p2/p3 (–Ω–∞–ø—Ä–∏–º–µ—Ä: –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –Ω–∞–≥—Ä—É–∑–∫–æ–π, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏—è–º–∏) –¥–ª—è –∞–≤—Ç–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–∏–¥–æ–≤.

